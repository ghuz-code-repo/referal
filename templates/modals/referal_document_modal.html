<!-- filepath: c:\Users\d.tolkunov\CodeRepository\AnalyticsRepo\referal\templates\modals\referal_document_modal.html -->
<!-- Модальное окно для заполнения документов реферала -->
<div id="DocumentFormModal_{{ referal.id }}" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close close_document_form" data-referal-id="{{ referal.id }}">&times;</span>
        <div class="modal-header">
            <h3>Заполнение документов реферала</h3>
        </div>
        
        <div class="modal-body">
            <div class="cards-container">
                <!-- Карточка MacroCRM -->
                <div class="data-card macro-card">
                    <h3><i class="fas fa-database"></i> Данные MacroCRM</h3>
                    
                    {% if referal.contact_id %}
                        {% set macro_contact = referal.get_macro_contact() %}
                        {% if macro_contact %}
                        <div class="card-content">
                            <!-- Основная строка с именем -->
                            <div class="name-row">
                                <span class="field-label">ФИО:</span>
                                <input type="text" 
                                       class="readonly-input"
                                       value="{{ macro_contact.full_name or 'Не указано' }}"
                                       readonly>
                            </div>
                            
                            <!-- Вторая строка: телефон и ID -->
                            <div class="info-row">
                                <div class="info-item full-phone">
                                    <span class="field-label">Телефон:</span>
                                    <input type="text" 
                                           class="readonly-input"
                                           value="{{ macro_contact.phone_number or 'Не указано' }}"
                                           readonly>
                                </div>
                                <div class="info-item">
                                    <span class="field-label">ID:</span>
                                    <input type="text" 
                                           class="readonly-input small"
                                           value="{{ macro_contact.contacts_id }}"
                                           readonly>
                                </div>
                            </div>
                            
                            <!-- Блок паспортной информации -->
                            <div class="passport-section">
                                <h4>Паспортная информация</h4>
                                <div class="passport-grid">
                                    <div class="passport-item">
                                        <span class="field-label">Номер:</span>
                                        <input type="text" 
                                               class="readonly-input unavailable"
                                               value="Недоступно"
                                               readonly>
                                    </div>
                                    <div class="passport-item">
                                        <span class="field-label">Дата выдачи:</span>
                                        <input type="text" 
                                               class="readonly-input unavailable"
                                               value="Недоступно"
                                               readonly>
                                    </div>
                                    <div class="passport-item full-width">
                                        <span class="field-label">Кем выдан:</span>
                                        <input type="text" 
                                               class="readonly-input unavailable"
                                               value="Недоступно"
                                               readonly>
                                    </div>
                                    <div class="passport-item full-width">
                                        <span class="field-label">Адрес регистрации:</span>
                                        <input type="text" 
                                               class="readonly-input unavailable"
                                               value="Недоступно"
                                               readonly>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Кнопка переноса всех данных внизу карточки MacroCRM -->
                            <div class="transfer-all-container">
                                <button type="button" 
                                        class="transfer-all-btn"
                                        data-referal-id="{{ referal.id }}"
                                        data-macro-name="{{ macro_contact.full_name or '' }}"
                                        data-macro-phone="{{ macro_contact.phone_number or '' }}"
                                        title="Перенести все доступные данные">
                                    <i class="fas fa-copy"></i> Перенести всё в карточку реферала
                                </button>
                            </div>
                        </div>
                        {% else %}
                        <div class="card-content empty">
                            <p><i class="fas fa-exclamation-triangle"></i> Данные не найдены в MacroCRM</p>
                        </div>
                        {% endif %}
                    {% else %}
                    <div class="card-content empty">
                        <p><i class="fas fa-unlink"></i> Реферал не связан с MacroCRM</p>
                    </div>
                    {% endif %}
                </div>

                <!-- Карточка реферала (точная копия структуры MacroCRM) -->
                <div class="data-card referal-card">
                    <h3><i class="fas fa-user-edit"></i> Данные реферала</h3>
                    
                    <form action="{{ url_for('referal.update_referal_documents', referal_id=referal.id) }}" method="POST">
                        <div class="card-content">
                            <!-- Основная строка с именем -->
                            <div class="name-row">
                                <span class="field-label">ФИО:</span>

                                    <input type="text" 
                                           id="referal_name_{{ referal.id }}"
                                           name="full_name" 
                                           class="editable-input"
                                           value="{{ referal.referal_data.full_name if referal.referal_data and referal.referal_data.full_name else '' }}"
                                           placeholder="Введите ФИО реферала" 
                                           required>
                                    {% if referal.contact_id %}
                                        {% set macro_contact = referal.get_macro_contact() %}
                                        {% if macro_contact and macro_contact.full_name %}
                                        <button type="button" 
                                                class="use-macro-btn"
                                                data-field="referal_name_{{ referal.id }}"
                                                data-macro-value="{{ macro_contact.full_name }}"
                                                title="Взять из MacroCRM">
                                            <i class="fas fa-download"></i>
                                        </button>
                                        {% endif %}
                                    {% endif %}
                            </div>
                            
                            <!-- Вторая строка: телефон и ID -->
                            <div class="info-row">
                                <div class="info-item full-phone">
                                    <span class="field-label">Телефон:</span>

                                        <input type="tel" 
                                               id="referal_phone_{{ referal.id }}"
                                               name="phone_number" 
                                               class="editable-input"
                                               value="{{ referal.referal_data.phone_number if referal.referal_data and referal.referal_data.phone_number else '+998 ' }}"
                                               placeholder="+998 XX XXX XX XX" 
                                               required>
  

                                </div>
                                <div class="info-item">
                                    <span class="field-label">ID:</span>
                                    <input type="text" 
                                           class="readonly-input small"
                                           value="{{ referal.contact_id or 'Не связан' }}"
                                           readonly>
                                </div>
                                {% if referal.contact_id %}
                                    {% set macro_contact = referal.get_macro_contact() %}
                                        {% if macro_contact and macro_contact.phone_number %}
                                            <button type="button" 
                                                    class="use-macro-btn"
                                                    data-field="referal_phone_{{ referal.id }}"
                                                    data-macro-value="{{ macro_contact.phone_number }}"
                                                    title="Взять из MacroCRM">
                                                <i class="fas fa-download"></i>
                                            </button>
                                        {% endif %}
                                {% endif %}
                            </div>
                            
                            <!-- Блок паспортной информации -->
                            <div class="passport-section">
                                <h4>Паспортная информация</h4>
                                <div class="passport-grid">
                                    <div class="passport-item">
                                        <span class="field-label">Номер:</span>
                                        <div class="passport-input-container">
                                            <input type="text" 
                                                   id="passport_number_{{ referal.id }}"
                                                   name="passport_number" 
                                                   class="editable-input"
                                                   value="{{ referal.referal_data.passport_number if referal.referal_data and referal.referal_data.passport_number else '' }}"
                                                   placeholder="AA1234567">
                                            <button type="button" 
                                                    class="use-macro-btn disabled"
                                                    title="Недоступно в MacroCRM">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="passport-item">
                                        <span class="field-label">Дата выдачи:</span>

                                        <div class="passport-input-container">
                                            <input type="date" 
                                                   id="passport_date_{{ referal.id }}"
                                                   name="passport_date" 
                                                   class="editable-input"
                                                   value="{{ referal.referal_data.passport_date.strftime('%Y-%m-%d') if referal.referal_data and referal.referal_data.passport_date else '' }}">
                                            <button type="button" 
                                                    class="use-macro-btn disabled"
                                                    title="Недоступно в MacroCRM">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="passport-item full-width">
                                        <span class="field-label">Кем выдан:</span>

                                        <div class="passport-input-container">
                                            <input type="text" 
                                                   id="passport_giver_{{ referal.id }}"
                                                   name="passport_giver" 
                                                   class="editable-input"
                                                   value="{{ referal.referal_data.passport_giver if referal.referal_data and referal.referal_data.passport_giver else '' }}"
                                                   placeholder="Название органа">
                                            <button type="button" 
                                                    class="use-macro-btn disabled"
                                                    title="Недоступно в MacroCRM">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="passport-item full-width">
                                        <span class="field-label">Адрес регистрации:</span>

                                        <div class="passport-input-container">
                                            <input type="text" 
                                                   id="passport_address_{{ referal.id }}"
                                                   name="passport_adress" 
                                                   class="editable-input"
                                                   value="{{ referal.referal_data.passport_adress if referal.referal_data and referal.referal_data.passport_adress else '' }}"
                                                   placeholder="Полный адрес регистрации">
                                            <button type="button" 
                                                    class="use-macro-btn disabled"
                                                    title="Недоступно в MacroCRM">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Кнопка сохранения внизу карточки реферала (аналогично кнопке переноса в MacroCRM) -->
                            <div class="save-all-container">
                                <button type="submit" class="save-all-btn">
                                    <i class="fas fa-save"></i> Сохранить данные реферала
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>