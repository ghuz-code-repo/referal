<!-- filepath: c:\Users\d.tolkunov\CodeRepository\AnalyticsRepo\referal\templates\admin.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Установка кодировки символов -->
    <meta charset="UTF-8">
    <!-- Адаптивный мета-тег -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Заголовок страницы -->
    <title>Панель администратора</title>
    <!-- Подключение файлов стилей -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Подключение CSS файлов -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layout.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/tables.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/forms.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/buttons.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/notifications.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/admin.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/responsive.css') }}">

    <!-- Подключение favicon -->
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
</head>
<body>
    {% include 'components/header.html' %}
    {% include 'components/flash_messages.html' %}
    
    <!-- Основной контент -->
    <main class="main">
        <div class="container">
            <h1 class="admin-panel__title">Панель администратора</h1>
            <h2 class="admin-panel__subtitle">Запросы на вывод средств</h2>
            <div class="table-container">
                <table class="table">
                    <thead class="table__head">
                        <tr class="table__row">
                            <th class="table__header">ID пользователя</th>
                            <th class="table__header">ФИО</th>
                            <th class="table__header">Номер телефона</th>
                            <th class="table__header">Номер договора</th>
                            <th class="table__header">Этап вывода</th>
                            <th class="table__header">Действие</th>
                        </tr>
                    </thead>
                    <tbody class="table__body">
                        {% for request in withdrawal_requests %}
                            {% for deal in request.deals %}
                        <tr class="table__row">
                            <td class="table__data">{{ request.user_id }}</td>
                            <td class="table__data">{{ request.referal_data.full_name }}</td>
                            <td class="table__data">{{ request.referal_data.phone_number }}</td>
                            <td class="table__data">{{ deal.agreement_number }}</td>
                            <td class="table__data">{{ request.status_name }}</td>
                            <td class="table__data">
                                <form
                                    action="{{ url_for('admin.update_withdrawal_stage', referal_id=request.id) }}"
                                    method="POST" class="form">
                                    <select name="withdrawal_stage" required class="form__select">
                                        {% for status in statuses %}
                                        <option value={{ status.id }}>{{ status.name }}</option>
                                        {% endfor %}
                                    </select>
                                    <input type="text"
                                        name="rejection_reason"
                                        placeholder="Причина отклонения"
                                        style="display: none;"
                                        class="form__input">
                                    <button type="submit" class="button" {{ 'disabled' if (request.status_id == 200 or request.status_id == 500 ) else '' }}>Обновить</button>
                                </form>
                            </td>
                        </tr>
                            {% endfor %}
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    {% include 'components/footer.html' %}

    <!-- Подключение JavaScript файлов -->
    <script src="{{ url_for('static', filename='js/components/flash-messages.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/password-validation.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    
    <!-- Дополнительные скрипты для админ панели -->
    <script>
        function validatePassword() {
            var password = document.getElementById("password");
            var confirm_password = document.getElementById("confirm_password");
            var message = document.getElementById("password-message");
            
            if (!password || !confirm_password || !message) return;
            
            var submitBtn = message.parentElement.querySelector("button[type='submit']");
            
            if (password.value && confirm_password.value) {
                if (password.value !== confirm_password.value) {
                    message.style.display = "block";
                    if (submitBtn) submitBtn.disabled = true;
                } else {
                    message.style.display = "none";
                    if (submitBtn) submitBtn.disabled = false;
                }
            }
        }
    </script>
</body>
</html>