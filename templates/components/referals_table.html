<div class="referals-section">
    <div class="section-header">
        <div class="section-title">
            <h3><i class="fas fa-users"></i> Мои рефералы</h3>
            <p class="section-subtitle">Список всех ваших рефералов и их статусы</p>
        </div>
        <div class="section-actions">
            {% if current_sort %}
            <a href="{{ url_for('referal.profile', **current_filters) }}" class="reset-sort-btn" title="Сбросить сортировку">
                <i class="fas fa-undo"></i> Сбросить сортировку
            </a>
            {% endif %}
            <button type="button" class="add-referal-btn open_document_form" data-referal-id="new">
                <i class="fas fa-plus"></i>
                Добавить реферала
            </button>
        </div>
        {% include 'components/add_referal_form.html' %}
    </div>
    
    {% if total_user_referals > 0 %}
    <div class="table-container">
        <table class="referals-table">
            <thead>
                <tr>
                    <th style="width: 15%;">
                        <div class="header-cell">
                            <span>ФИО</span>
                            <a href="{{ url_for('referal.profile', sort='name', order='asc' if current_sort != 'name' or current_order == 'desc' else 'desc', **current_filters) }}" 
                               class="sort-btn {{ 'active-asc' if current_sort == 'name' and current_order == 'asc' else 'active-desc' if current_sort == 'name' and current_order == 'desc' else '' }}">
                                <i class="fas fa-sort"></i>
                            </a>
                        </div>
                        <input type="text" 
                               class="header-filter" 
                               placeholder="Поиск по ФИО"
                               value="{{ current_filters.name }}"
                               data-filter="name">
                    </th>
                    <th style="width: 12%;">
                        <div class="header-cell">
                            <span>Телефон</span>
                            <a href="{{ url_for('referal.profile', sort='phone', order='asc' if current_sort != 'phone' or current_order == 'desc' else 'desc', **current_filters) }}" 
                               class="sort-btn {{ 'active-asc' if current_sort == 'phone' and current_order == 'asc' else 'active-desc' if current_sort == 'phone' and current_order == 'desc' else '' }}">
                                <i class="fas fa-sort"></i>
                            </a>
                        </div>
                        <input type="text" 
                               class="header-filter" 
                               placeholder="Поиск по телефону"
                               value="{{ current_filters.phone }}"
                               data-filter="phone">
                    </th>
                    <th style="width: 12%;">
                        <div class="header-cell">
                            <span>Договор</span>
                            <a href="{{ url_for('referal.profile', sort='contract', order='asc' if current_sort != 'contract' or current_order == 'desc' else 'desc', **current_filters) }}" 
                               class="sort-btn {{ 'active-asc' if current_sort == 'contract' and current_order == 'asc' else 'active-desc' if current_sort == 'contract' and current_order == 'desc' else '' }}">
                                <i class="fas fa-sort"></i>
                            </a>
                        </div>
                        <input type="text" 
                               class="header-filter" 
                               placeholder="Номер договора"
                               value="{{ current_filters.contract }}"
                               data-filter="contract">
                    </th>
                    <th style="width: 8%;">
                        <div class="header-cell">
                            <span>Macro ID</span>
                        </div>
                        <input type="text" 
                               class="header-filter" 
                               placeholder="Macro ID"
                               value="{{ current_filters.contact_id }}"
                               data-filter="contact_id">
                    </th>
                    <th style="width: 10%;">
                        <div class="header-cell">
                            <span>Статус</span>
                            <a href="{{ url_for('referal.profile', sort='status', order='asc' if current_sort != 'status' or current_order == 'desc' else 'desc', **current_filters) }}" 
                               class="sort-btn {{ 'active-asc' if current_sort == 'status' and current_order == 'asc' else 'active-desc' if current_sort == 'status' and current_order == 'desc' else '' }}">
                                <i class="fas fa-sort"></i>
                            </a>
                        </div>
                        <select class="header-filter header-select" data-filter="status">
                            <option value="">Все</option>
                            <option value="no_status" {{ 'selected' if current_filters.status == 'no_status' else '' }}>Не начата</option>
                            {% for status in statuses %}
                                {% if status.id != 0 %}
                                <option value="{{ status.id }}" {{ 'selected' if current_filters.status == status.id|string else '' }}>
                                    {{ status.name }}
                                </option>
                                {% endif %}
                            {% endfor %}
                        </select>
                    </th>
                    <th style="width: 10%;">
                        <div class="header-cell">
                            <span>Сумма к выводу</span>
                            <a href="{{ url_for('referal.profile', sort='amount', order='asc' if current_sort != 'amount' or current_order == 'desc' else 'desc', **current_filters) }}" 
                               class="sort-btn {{ 'active-asc' if current_sort == 'amount' and current_order == 'asc' else 'active-desc' if current_sort == 'amount' and current_order == 'desc' else '' }}">
                                <i class="fas fa-sort"></i>
                            </a>
                        </div>
                    </th>
                    <th style="width: 12%;">
                        <div class="header-cell">
                            <span>Вывод средств</span>
                        </div>
                    </th>
                    <th style="width: 11%;">
                        <div class="header-cell">
                            <span>Документы</span>
                        </div>
                    </th>
                    <th style="width: 10%;">
                        <div class="header-cell">
                            <span>Скачать акт</span>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                {% if referals %}
                    {% for referal in referals %}
                        {% include 'components/referal_table_row.html' %}
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="9" class="no-results">
                            <div class="no-results-content">
                                <i class="fas fa-search"></i>
                                <h4>По заданным фильтрам ничего не найдено</h4>
                                <p>Попробуйте изменить параметры поиска</p>
                            </div>
                        </td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
    
    <!-- Пагинация под таблицей - показывается всегда -->
    {% include 'components/pagination.html' %}
    {% else %}
    <div class="empty-state">
        <div class="empty-icon">
            <i class="fas fa-users"></i>
        </div>
        <h4>У вас пока нет рефералов</h4>
        <p>Добавьте первого реферала, нажав кнопку "Добавить реферала"</p>
    </div>
    
    <!-- Пагинация показывается даже при отсутствии рефералов -->
    {% include 'components/pagination.html' %}
    {% endif %}
</div>
